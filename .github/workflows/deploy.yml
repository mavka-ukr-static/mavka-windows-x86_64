name: Build

on:
  push:
    tags:
      - "*.*.*-*"
      
jobs:
  deploy:
    name: Try build on windows
    runs-on: windows-latest
    steps:
      - uses: actions/checkout@v4
      - name: Build
        run: |
          choco install ninja -y
          mkdir build
          mkdir build\мавка
          mkdir build\мавка\бібліотека
          mkdir build\МаМа
          mkdir build\МаМа\КД
          clang -target x86_64-windows-gnu -c -o build\mavka.o .плавлення\мавка\бібліотека\М.ll .плавлення\мавка\бібліотека\М.ll .плавлення\мавка\бібліотека\мавка.ll .плавлення\мавка\бібліотека\МаМа.ll .плавлення\мавка\бібліотека\читати_юнікод.ll .плавлення\мавка\компілятор.ll .плавлення\мавка\мавка.ll .плавлення\старт.ll .плавлення\МаМа\КД\КД.ll .плавлення\МаМа\біб.ll .плавлення\МаМа\Код.ll .плавлення\МаМа\Машина.ll .плавлення\МаМа\Назва.ll .плавлення\МаМа\Обʼєкт.ll .плавлення\МаМа\ОбʼєктБайтів.ll .плавлення\МаМа\ОбʼєктДії.ll .плавлення\МаМа\ОбʼєктЛогічного.ll .плавлення\МаМа\ОбʼєктМодуля.ll .плавлення\МаМа\ОбʼєктНативноїДії.ll .плавлення\МаМа\ОбʼєктСловника.ll .плавлення\МаМа\ОбʼєктСписку.ll .плавлення\МаМа\ОбʼєктСтруктури.ll .плавлення\МаМа\ОбʼєктТексту.ll .плавлення\МаМа\ОбʼєктЮнікоду.ll .плавлення\МаМа\ОбʼєктЧисла.ll .плавлення\МаМа\Помилка.ll .плавлення\МаМа\Середовище.ll .плавлення\МаМа\СкладенийОбʼєкт.ll .плавлення\МаМа\Утилізатор.ll
          cd build
          cmake -DCMAKE_CXX_COMPILER:FILEPATH="C:/Program Files/LLVM/bin/clang.exe" -DCMAKE_C_COMPILER:FILEPATH="C:/Program Files/LLVM/bin/clang.exe" -DCMAKE_LINKER:FILEPATH="C:/Program Files/LLVM/bin/lld-link.exe" -DCMAKE_CXX_FLAGS="-target x86_64-windows-gnu -std=c++20" -DCMAKE_C_FLAGS="-target x86_64-windows-gnu -std=c++20" -DCMAKE_EXE_LINKER_FLAGS_INIT="-fuse-ld=lld" -DCMAKE_MODULE_LINKER_FLAGS_INIT="-fuse-ld=lld" -DCMAKE_SHARED_LINKER_FLAGS_INIT="-fuse-ld=lld" -G "Ninja" ..\external -DREADLINE_AVAILABLE=0
          ninja
          cd ..
          Compress-Archive -Path build/mavka.exe -Destination mavka.zip
      - name: Release
        uses: softprops/action-gh-release@v2
        with:
          files: mavka.zip

